@inherits LayoutComponentBase
@inject NavigationManager Navigation

<MudThemeProvider IsDarkMode="@_isDarkMode" Theme="@_customTheme" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <!-- AppBar -->
    <MudAppBar Elevation="1" Color="Color.Primary">
        <MudIconButton Icon="@Icons.Material.Filled.Menu"
                       Color="Color.Inherit"
                       Edge="Edge.Start"
                       OnClick="ToggleDrawer" />
        <MudText Typo="Typo.h6">Welcome, Binod!</MudText>
        <MudSpacer />
        <MudSpacer />

        <MudIconButton Icon="@(_isDarkMode 
        ? Icons.Material.Filled.LightMode 
        : Icons.Material.Filled.DarkMode)"
               Color="Color.Inherit"
               OnClick="ToggleTheme" />
        <!-- Profile Section -->
        <MudMenu AnchorOrigin="Origin.BottomRight"
                 TransformOrigin="Origin.TopRight"
                 Dense="true">
            <ActivatorContent>
                <MudChip T="string" Color="Color.Secondary"
                         Icon="@Icons.Material.Filled.Person"
                         Variant="Variant.Filled"
                         Style="cursor: pointer;">
                    @CurrentUser.Name
                </MudChip>
            </ActivatorContent>
            <ChildContent>
                <MudMenuItem Icon="@Icons.Material.Filled.AccountCircle"
                             OnClick="NavigateToProfile">
                    Profile
                </MudMenuItem>
                <MudDivider />
                <MudMenuItem Icon="@Icons.Material.Filled.Logout"
                             OnClick="Logout"
                             IconColor="Color.Error">
                    Logout
                </MudMenuItem>
            </ChildContent>
        </MudMenu>
    </MudAppBar>

    <!-- Sidebar / Drawer -->
    <MudDrawer @bind-Open="_drawerOpen"
               Variant="DrawerVariant.Persistent"
               Elevation="1">
        <MudDrawerHeader>
            <MudText Typo="Typo.h6">Menu</MudText>
        </MudDrawerHeader>
        <MudNavMenu>
            @foreach (var item in MenuItems)
            {
                <MudNavLink Href="@item.Route"
                            Icon="@item.Icon"
                            Match="NavLinkMatch.All">
                    @item.Title
                </MudNavLink>
            }
        </MudNavMenu>
    </MudDrawer>

    <!-- Main Content -->
    <MudMainContent Class="pa-4 mt-4">
        @Body
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;

    private bool _isDarkMode = false;

    private UserInfo CurrentUser = new UserInfo("Binod Thapa", "binod@gmail.com");


    private MudTheme _customTheme = new MudTheme()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = "#1976D2",
            Secondary = "#424242",
            AppbarBackground = "#1976D2",
        },
        PaletteDark = new PaletteDark()
        {
            Primary = "#90CAF9",
            Secondary = "#90CAF9",
            AppbarBackground = "#1E1E1E",
            Background = "#121212",
            Surface = "#1E1E1E"
        }
    };

    void ToggleTheme()
    {
        _isDarkMode = !_isDarkMode;
    }

    void ToggleDrawer()
    {
        _drawerOpen = !_drawerOpen;
    }

    void NavigateToProfile()
    {
        Navigation.NavigateTo("/profile");
    }

    void Logout()
    {
        // TODO: Implement actual logout logic
        // Clear authentication state
        // Redirect to login
        Navigation.NavigateTo("/login");
    }

    private List<MenuItem> MenuItems = new()
    {
        new MenuItem("Dashboard", "/", Icons.Material.Filled.Dashboard),
        new MenuItem("Journals", "/journals", Icons.Material.Filled.Book),
        new MenuItem("Calendar", "/calendar", Icons.Material.Filled.CalendarMonth),
    };

    public record MenuItem(string Title, string Route, string Icon);
    public record UserInfo(string Name, string Email);
}